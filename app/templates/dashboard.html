
{% extends "layout.html" %}
{% block content %}
<h2 class="mb-4">Panel de Usuario</h2>

{% if session.get('rol') == 'admin' %}
<form method="get" action="/dashboard" class="mb-4">
    <label for="rol" class="form-label">Selecciona tipo de usuario:</label>
    <select name="rol" id="rol" class="form-select w-50" onchange="this.form.submit()">
        <option value="">-- Selecciona un rol --</option>
        <option value="sucursal1" {% if rol == 'sucursal1' %}selected{% endif %}>Sucursal 1</option>
        <option value="sucursal2" {% if rol == 'sucursal2' %}selected{% endif %}>Sucursal 2</option>
        <option value="sucursal3" {% if rol == 'sucursal3' %}selected{% endif %}>Sucursal 3</option>
        <option value="credit" {% if rol == 'credit' %}selected{% endif %}>Tarjetas de Crédito</option>
        <option value="mercadeo" {% if rol == 'mercadeo' %}selected{% endif %}>Mercadeo</option>
        <option value="admin" {% if rol == 'admin' %}selected{% endif %}>Administrador</option>
    </select>
</form>
{% endif %}

{% if rol and datos %}
    <h4>Datos de: {{ rol|capitalize }}</h4>
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead class="table-dark text-center">
                <tr>
                    {% for key in datos[0].keys() %}
                        <th>{{ key.replace('_', ' ') | capitalize }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for fila in datos %}
                    <tr>
                        {% for key, valor in fila.items() %}
                            <td>
                                {% if key == "numero_cuenta" %}
                                    {% if valor %}
                                        <a href="/cuenta/{{ rol }}/{{ valor }}" class="text-primary">{{ valor }}</a>
                                    {% else %}
                                        <a href="/acciones/crear-cuenta?dpi={{ fila['documento_identidad'] }}&sucursal={{ rol }}" class="btn btn-sm btn-success">Crear cuenta</a>
                                    {% endif %}
                                {% else %}
                                    {{ valor if valor is not none else "—" }}
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% elif rol %}
    <div class="alert alert-warning">No hay datos disponibles para este rol.</div>
{% endif %}
{% endblock %}